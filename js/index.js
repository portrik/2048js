!function(e){var t={};function s(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(r,i,function(t){return e[t]}.bind(null,i));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";const r=new(s(1).Game);!function(){let e=document.getElementById("warning");e.parentNode.removeChild(e),document.getElementById("menu-toggle").addEventListener("click",(function(e){e.preventDefault(),document.getElementById("mobile-menu").style.transform="translateX(100%)"})),document.getElementById("close-menu").addEventListener("click",(function(e){e.preventDefault(),document.getElementById("mobile-menu").style.transform="translateX(-100%)"})),r.setUpGame(document.getElementById("game-area"))}()},function(e,t,s){"use strict";s.r(t),s.d(t,"Game",(function(){return n}));class r{constructor(e){this.colors={2:"#eee4da",4:"#ede0c8",8:"#f2b179",16:"#f59563",32:"#f67c5f",64:"#f65e3b",128:"#edcf72",256:"#edcc61",512:"#edc850",1024:"#edc53f",2048:"#edc53f"},this.value=e,this.fontHeight=80,this.color=this.colors[this.value]}merge(){return this.value*=2,this.color=this.colors[this.value],this.value}toString(){return this.value.toString()}}class i{constructor(e){this.chance=.1,this.area=e,this.resizeArea(),this.size=0,this.board=[],this.previousState=null,window.addEventListener("resize",()=>this.resizeArea())}resizeArea(){let e=window.innerWidth,t=window.innerHeight;e>t?(t=Math.round(.85*t),e=t):(e=Math.round(.85*e),t=e),this.width=e,this.height=t;let s=this.area.getContext("2d");s.canvas.width=e,s.canvas.height=t,this.drawBoard()}setUp(e){this.size=e,this.board=new Array(this.size);for(let e=0;e<this.size;++e)this.board[e]=new Array(this.size),this.board[e].fill(null);this.checkBoard(!0),this.checkBoard(!0),this.drawBoard()}setBoard(e){this.size=e.length;for(let t=0;t<this.size;++t){this.board[t]=[];for(let s=0;s<e[t].length;++s)e[t][s]?this.board[t][s]=new r(e[t][s].value):this.board[t][s]=null}this.drawBoard()}undoLastMove(){this.previousState&&(this.board=this.copy2DArray(this.previousState),this.previousState=null,this.drawBoard())}moveTiles(e){this.previousState=this.copy2DArray(this.board);let t=this.getMovableArray(e),s=!1;for(let e=0;e<t.length;++e){let r=this.cleanUpLine(t[e]);this.compareArrays(r,t[e])||(t[e]=r,s=!0)}this.applyMovedArray(t,e),this.checkBoard(s),this.drawBoard()}drawBoard(){let e=Math.round((this.width-10*(this.size-1))/this.size),t=this.area.getContext("2d");t.clearRect(0,0,t.canvas.width,t.canvas.height);let s=0,r=0;for(let i=0;i<this.size;++i){for(let o=0;o<this.size;++o){if(this.board[i][o]){t.fillStyle=this.board[i][o].color,t.fillRect(s,r,e,e),t.font=this.board[i][o].fontHeight+"px Source Sans Pro",t.textAlign="center",t.fillStyle="black",t.textBaseline="middle";let a=s+Math.round(e/2),n=r+Math.round(e/2)+10;t.fillText(this.board[i][o].value,a,n)}else t.fillStyle="rgba(238, 228, 218, 0.35)",t.fillRect(s,r,e,e);s+=e+10}s=0,r+=e+10}}dispatchVictory(){this.area.dispatchEvent(new Event("victory"))}spawnTile(e){let t=Math.round(Math.random()*(e.length-1)),s=e[t][0],i=e[t][1],o=2;Math.random()<this.chance&&(o=4),this.board[s][i]=new r(o)}checkBoard(e){let t=[];for(let e=0;e<this.board.length;++e)for(let s=0;s<this.board.length;++s)null==this.board[e][s]&&t.push([e,s]);if(t.length>0&&e)this.spawnTile(t);else if(0==t.length){let e=!1;for(let t=0;t<this.size;++t)for(let s=0;s<this.size-1;++s)this.board[t][s].value==this.board[t][s+1].value&&(e=!0);for(let t=0;t<this.size-1;++t)for(let s=0;s<this.size;++s)this.board[t][s].value==this.board[t+1][s].value&&(e=!0);e||this.area.dispatchEvent(new Event("gameOver"))}}compareArrays(e,t){let s=!0;for(let r=0;r<e.length;r++)e[r]!=t[r]&&(s=!1);return s}cleanUpLine(e){let t=this.shiftLine(e);for(let e=0;e<t.length-1;++e)if(null!=t[e]&&null!=t[e+1]&&t[e].value==t[e+1].value){t[e].merge()==Math.pow(2,3*this.size-1)&&this.dispatchVictory(),this.area.dispatchEvent(new CustomEvent("scoreUp",{detail:{value:t[e].value}})),t[e+1]=null}return t=this.shiftLine(t),t}shiftLine(e){let t=e.filter(e=>null!=e);for(let s=t.length;s<e.length;++s)t.push(null);return t}getMovableArray(e){let t=[];switch(e){case"left":this.board.forEach(e=>t.push(e));break;case"right":this.board.forEach(e=>t.push(e.reverse()));break;case"up":for(let e=0;e<this.size;++e){t[e]=[];for(let s=0;s<this.size;++s)t[e].push(this.board[s][e])}break;case"down":for(let e=0;e<this.size;++e){t[e]=[];for(let s=this.size-1;s>=0;--s)t[e].push(this.board[s][e])}}return t}applyMovedArray(e,t){switch(t){case"left":for(let t=0;t<e.length;++t)this.board[t]=e[t];break;case"right":for(let t=0;t<e.length;++t)this.board[t]=e[t].reverse();break;case"up":for(let t=0;t<e.length;++t){let s=[];for(let r=0;r<e.length;++r)s.push(e[r][t]);this.board[t]=s}break;case"down":for(let t=0;t<e.length;++t){let s=[];for(let r=0;r<e.length;++r)s.push(e[r][t]);this.board[t]=s}this.board.reverse()}}copy2DArray(e){let t=[];for(let s=0;s<e.length;++s){t[s]=[];for(let i=0;i<e[s].length;++i)e[s][i]?t[s][i]=new r(e[s][i].value):t[s][i]=null}return t}}class o{constructor(e){this.keyCodes={ArrowLeft:"left",ArrowUp:"up",ArrowRight:"right",ArrowDown:"down",a:"left",w:"up",d:"right",s:"down"},this.touchX=0,this.touchY=0,this.tolerance=50,this.targetElement=e,this.enableController()}enableController(){document.addEventListener("keydown",e=>this.handleKeydown(e)),this.targetElement.addEventListener("touchstart",e=>this.handleTouchStart(e)),this.targetElement.addEventListener("touchend",e=>this.handleTouchEnd(e))}handleKeydown(e){if(Object.keys(this.keyCodes).indexOf(e.key)>-1){let t=new CustomEvent("moveGameBoard",{detail:{direction:this.keyCodes[e.key]}});this.targetElement.dispatchEvent(t),e.key.includes("Arrow")&&e.preventDefault()}}handleTouchStart(e){e.preventDefault(),this.touchX=Math.round(e.touches[0].screenX),this.touchY=Math.round(e.touches[0].screenY)}handleTouchEnd(e){let t=Math.round(e.changedTouches[0].screenX),s=Math.round(e.changedTouches[0].screenY),r="";if(Math.abs(s-this.touchY)>this.tolerance?r=s>this.touchY?"down":"up":Math.abs(t-this.touchX)>this.tolerance&&(r=t>this.touchX?"right":"left"),""!==r){let e=new CustomEvent("moveGameBoard",{detail:{direction:r}});this.targetElement.dispatchEvent(e)}}}class a{constructor(){this.isUsable=this.checkAvailability()}checkAvailability(){let e,t="__storage_test__";try{localStorage.setItem(t,t),localStorage.removeItem(t),e=!0}catch(t){e=!1}return e}storeItem(e,t){this.isUsable&&localStorage.setItem(e,JSON.stringify(t))}loadItem(e){let t=null;if(this.isUsable){let s=localStorage.getItem(e);t=JSON.parse(s)}return t}removeItem(e){this.isUsable&&localStorage.removeItem(e)}}class n{constructor(){this.score=0,this.lastValue=0,this.size=4,this.saveTimeout=null,this.storage=new a,this.won=!1,this.lost=!1}setUpGame(e){this.setUpController(e),this.playArea=new i(e),this.loadLocalData(),document.getElementById("score").innerText=this.score,e.addEventListener("gameOver",()=>this.gameOver()),e.addEventListener("victory",()=>this.victory()),e.addEventListener("scoreUp",e=>this.updateScore(e.detail.value)),document.getElementById("reset").addEventListener("click",e=>{this.resetGame(),e.preventDefault()}),document.getElementById("game-over-restart").addEventListener("click",e=>{this.resetGame(),e.preventDefault()}),document.getElementById("undo").addEventListener("click",e=>{this.undoLastMove(),e.preventDefault()}),document.getElementById("victory").addEventListener("click",e=>{document.getElementById("victory").style.display="none",e.preventDefault()})}setUpController(e){this.controller=new o(e),e.addEventListener("moveGameBoard",e=>{this.lost||this.playArea.moveTiles(e.detail.direction)})}loadLocalData(){let e=this.storage.loadItem("board");e?(this.score=e.score,this.size=e.board.length,this.won=e.won,this.playArea.setBoard(e.board)):this.playArea.setUp(this.size)}updateScore(e){this.lastValue=e,this.score+=e,document.getElementById("score").innerText=this.score,this.saveTimeout&&(clearTimeout(this.saveTimeout),this.saveTimeout=null),this.saveTimeout=setTimeout(()=>{let e={board:this.playArea.board,score:this.score,won:this.won};this.storage.storeItem("board",e)},2e3)}resetGame(){document.getElementById("victory").style.display="none",document.getElementById("game-over").style.display="none",this.score=0,this.lost=!1,this.won=!1,document.getElementById("score").innerText=this.score,this.storage.removeItem("board"),this.playArea.setUp(this.size)}setSize(e){this.size=e,this.resetGame()}undoLastMove(){this.score-=this.lastValue,this.lastValue=0,this.playArea.undoLastMove(),document.getElementById("score").innerText=this.score}gameOver(){this.lost||(document.getElementById("game-over").style.display="flex",document.getElementById("game-over").style.opacity="100%",this.lost=!0,this.storage.removeItem("board"))}victory(){this.won||(document.getElementById("victory-value").innerText=Math.pow(2,3*this.size-1),document.getElementById("victory").style.display="flex",document.getElementById("victory").style.opacity="100%",this.won=!0)}}}]);